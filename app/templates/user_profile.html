{% extends "base.html" %}

{%block content%}
<table>
    <tr valign="top">
        <td><img src="{{user.avatar(128)}}"></td>
        <td>
            <h1>{{user.username}}</h1>
            {% if user.about_me %}
            <p>About me: {{user.about_me}}</p>
            {%endif%}
            {% if user.last_seen %}
            <p>Last seen on: {{moment(user.last_seen).format('LLL')}}</p>
            <p> {{user.followers.count()}} followers, {{user.followed.count()}} following </p>
            {%endif%}
        </td>
        {% if user == current_user %}
        <td><a href="{{url_for('main.edit_profile')}}">Edit profile</a> </td>
        
        {% elif not current_user.is_following(user) %}
        <p><a href="{{url_for('main.follow', username=user.username)}}">Follow</a></p>
        {% else %}
        <p><a href="{{url_for('main.unfollow', username=user.username)}}">Unfollow</a></p>
        {%endif%}
        {% if user!=current_user %}
        <p><a href="{{url_for('main.send_message', receiver=user.username)}}">Send Message</a></p>
        {% endif %}
        
            {% if not current_user.get_task_in_progress('export_posts')%}
            <p>
                <a href="{{ url_for('main.export_posts') }}">
                    Export your posts
                </a>
            </p>
            {%endif%}
        
    </tr>
</table>
{% if current_user.is_authenticated %}
<P>Hello {{current_user.username}}</P>
<p>This is your email {{current_user.email}}</p>
{%endif%}

{% for post in posts%}
    {% include "_post.html" %}
{%endfor%}
<!-- pagination -->
<nav aria-label="Post navigation">
    <ul class="pagination">
        <li class="page-item {% if not prev_url %} disabled{% endif %}">
            <a class="page-link" href="{{ prev_url }}">
                <span aria-hidden="true">&larr;</span> Newer posts
            </a>
        </li>
        <li class="page-item {% if not next_url %} disabled{% endif %}">
            <a class="page-link" href="{{ next_url }}">
                Older posts <span aria-hidden="true">&rarr;</span>
            </a>
        </li>
    </ul>
</nav>

{% endblock %}